"use strict";(self.webpackChunkreact_basic=self.webpackChunkreact_basic||[]).push([[690],{70690:(e,t,s)=>{s.r(t),s.d(t,{default:()=>D});var r=s(16569),n=s(58732),i=s(10903),a=s(87021),o=s(57332),l=s(56597),d=s(74727),u=s(65043),c=s(83003),m=s(21232),p=s(20691),h=s(89073),w=s(18705),y=s(66925),g=s(70579);const x=e=>{let{quiz:t}=e;const s=[{key:"2",label:"Time Created",children:new Date(1e3*t.timeCreated).toLocaleDateString()},{key:"3",label:"Duration",children:`${t.duration} seconds`}];return(0,g.jsx)(p.A,{title:t.name,items:s,column:1,size:"small"})},v=e=>{let{quiz:t,onClick:s}=e;return(0,g.jsx)(h.A,{hoverable:!0,className:"group relative h-60 w-72 overflow-hidden transition-all duration-300",cover:(0,g.jsx)("div",{className:"absolute inset-0",children:(0,g.jsx)("img",{src:"https://static.vecteezy.com/system/resources/thumbnails/029/291/834/small/quiz-logo-with-speech-bubble-symbols-concept-of-questionnaire-show-sing-quiz-button-question-competition-png.png",alt:"Background",className:"h-full w-full object-cover"})}),onClick:s,children:(0,g.jsxs)("div",{className:"absolute left-0 top-44 h-full w-full rounded-lg bg-gray-100 p-4 shadow-lg transition-all duration-300 ease-in-out group-hover:-translate-y-32 group-hover:shadow-xl",children:[(0,g.jsx)(x,{quiz:t}),(0,g.jsx)(a.Ay,{className:"absolute left-1/2 mt-4 w-[90%] -translate-x-1/2",type:"primary",onClick:async e=>{e.stopPropagation(),(0,y.Q)((async()=>{const e=prompt("Please input the auto start player number");if(!e)return;const{data:{sessionId:s}}=await(0,w.IV)(t.quizId,parseInt(e));window.open(`/quiz-session/${s}/admin?quizId=${t.quizId}&autoStartNum=${e}`,"_blank")}))},children:"Play"})]})})};var A=s(27739),q=s(67884),b=s(65681),f=s(60647),I=s(71298),j=s(75337),z=s(66098),C=s(96651),k=s(62878);const N=e=>{var t,s,n;let{questionId:i}=e;const a=(0,c.wA)(),o=(null===(t=(0,c.d4)((e=>e.user.editingQuiz)))||void 0===t||null===(s=t.questions)||void 0===s||null===(n=s.find((e=>e.questionId===i)))||void 0===n?void 0:n.answers)||[],[l,d]=(0,u.useState)([]),p=[{title:(0,g.jsxs)(C.A,{title:"Question can have 3 - 6 answers, including at least one correct answer",children:["Answers",(0,g.jsx)("span",{className:"ml-1",children:(0,g.jsx)(k.A,{})})]}),dataIndex:"answer",width:"40%",formItemProps:{rules:[{required:!0,message:"Answer is required"},{max:30,message:"Answer must be less than 30 characters"}]}},{title:"Correct",dataIndex:"correct",valueType:"switch",width:"20%",valueEnum:{true:{text:"Correct",status:"Success"},false:{text:"Wrong",status:"Error"}},render:(e,t)=>(0,g.jsx)("span",{style:{color:t.correct?"#52c41a":"#ff4d4f"},children:t.correct?"Correct":"Wrong"})},{title:"Actions",valueType:"option",width:"25%",render:(e,t,s,n)=>[(0,g.jsx)("a",{onClick:()=>{var e;null===n||void 0===n||null===(e=n.startEditable)||void 0===e||e.call(n,t.answerId)},children:"Edit"},"editable"),(0,g.jsx)("a",{onClick:()=>{const e=o.filter((e=>e.answerId!==t.answerId));e.find((e=>!0===e.correct))||r.Ay.warning("At least one answer should be marked as correct."),e.length<3&&r.Ay.warning("At least 3 answers are required."),e.length>6&&r.Ay.warning("At most 6 answers are allowed."),a((0,m.mY)({questionId:i,answers:e})),r.Ay.success("Answer deleted")},children:"Delete"},"delete")]}];return(0,g.jsx)(z.A,{rowKey:"answerId",pagination:!1,columns:p,value:o,onChange:e=>a((0,m.mY)({questionId:i,answers:e})),editable:{type:"multiple",editableKeys:l,onSave:async(e,t,s)=>{console.log(e,t,s);const n=[...o.filter((e=>e.answerId!==t.answerId)),t];n.find((e=>!0===e.correct))||r.Ay.warning("At least one answer should be marked as correct."),n.length<3&&r.Ay.warning("At least 3 answers are required."),n.length>6&&r.Ay.warning("At most 6 answers are allowed."),a((0,m.mY)({questionId:i,answers:n})),r.Ay.success("Answer saved")},onChange:d},recordCreatorProps:{position:"bottom",record:()=>({answerId:o.length+1,answer:"",colour:"#000000",correct:!1}),creatorButtonText:"Add a new answer"}})},S=()=>{var e;const[t,s]=(0,u.useState)([]),n=(0,c.wA)(),[i,o]=(0,u.useState)([]),l=(null===(e=(0,c.d4)((e=>e.user.editingQuiz)))||void 0===e?void 0:e.questions)||[],d=[{title:"Sort",dataIndex:"sort",className:"drag-visible",editable:!1},{title:"Name",dataIndex:"question",width:250,formItemProps:{rules:[{required:!0,message:"Name is required"},{min:5,max:50,message:"Name must be between 5 and 50 characters"}]}},{title:"Points",dataIndex:"points",valueType:"digit",formItemProps:{rules:[{required:!0,message:"Points are required"},{validator:(e,t)=>t<1||t>10?Promise.reject("Points must be between 1 and 10"):Promise.resolve()}]}},{title:"Duration",dataIndex:"duration",valueType:"digit",formItemProps:{rules:[{required:!0,message:"Duration is required"},{validator:(e,t)=>t<=0?Promise.reject("Duration must be a positive number"):Promise.resolve()}]}},{title:"# Answers",editable:!1,render:(e,t)=>{var s;return(null===(s=t.answers)||void 0===s?void 0:s.length)||0}},{title:"Action",valueType:"option",render:(e,t,s,i)=>[(0,g.jsx)("a",{onClick:()=>{var e;null===i||void 0===i||null===(e=i.startEditable)||void 0===e||e.call(i,t.questionId)},children:"Edit"},"editable"),(0,g.jsx)(f.A,{title:"Are you sure to delete this question?",onConfirm:()=>{const e=l.filter((e=>e.questionId!==t.questionId));n((0,m.mX)({questions:e})),r.Ay.success("Deleted successfully")},children:(0,g.jsx)("a",{children:"Delete"})},"delete")]}];return(0,g.jsx)(I.A,{headerTitle:"Questions",pagination:!1,columns:d,rowKey:"questionId",dataSource:l,onChange:e=>n((0,m.mX)({questions:e})),dragSortKey:"sort",onDragSortEnd:(e,t,s)=>{console.log("\u6392\u5e8f\u540e\u7684\u6570\u636e",s),n((0,m.mX)({questions:s})),r.Ay.success("\u4fee\u6539\u5217\u8868\u6392\u5e8f\u6210\u529f")},expandable:{expandedRowRender:e=>(0,g.jsx)(N,{questionId:e.questionId}),defaultExpandedRowKeys:i,onExpand:(e,t)=>{o(e?e=>[...e,t.questionId]:e=>e.filter((e=>e!==t.questionId)))}},editable:{type:"multiple",editableKeys:t,onSave:async(e,t,s)=>{console.log(e,t,s);const r=l.map((e=>e.questionId===t.questionId?t:e));n((0,m.mX)({questions:r}))},onChange:s},search:!1,options:{search:!1,fullScreen:!1,reload:!1,setting:!1,density:!1},toolBarRender:()=>[(0,g.jsx)(a.Ay,{type:"primary",onClick:()=>{const e=l.length+1,r={questionId:e,question:`New Question ${e}`,duration:10,points:1,answers:[]};n((0,m.mX)({questions:[...l,r]})),s([...t,e])},icon:(0,g.jsx)(j.A,{}),children:"Add New Row"},"add")]})};var E=s(78507),Q=s(8821);const P=e=>{let{open:t,setOpen:s}=e;const[n]=E.A.useForm(),i=(0,c.wA)(),o=(0,c.d4)((e=>e.user.editingQuiz)),l=void 0===o.name;return(0,g.jsxs)(A.K,{title:(0,g.jsx)("h1",{className:"mb-6 text-2xl font-bold",children:l?"Create Quiz":"Edit Quiz"}),open:t,form:n,autoFocusFirstInput:!0,modalProps:{destroyOnClose:!0,onCancel:()=>s(!1)},submitTimeout:2e3,onFinish:async e=>{try{return console.log(e),l?await i((0,m.Sv)(e.name,e.description)):await i((0,m.sw)(o.quizId,e.name,e.description)),r.Ay.success("Submitted successfully"),s(!1),!0}catch(a){var t,n;if(console.log(a),a instanceof Q.pe)r.Ay.error(null===(t=a.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.error);else r.Ay.error("Failed to submit")}},onFinishFailed:()=>{r.Ay.error("Failed to submit")},submitter:{render:(e,t)=>[!l&&(0,g.jsx)(f.A,{title:"Are you sure you want to delete this quiz?",onConfirm:async()=>{try{await i((0,m.pM)(o.quizId)),s(!1),r.Ay.success("Deleted successfully")}catch(e){r.Ay.error("Failed to delete")}},okText:"Yes",cancelText:"No",children:(0,g.jsx)(a.Ay,{danger:!0,children:"Delete"},"delete")}),...t.map((e=>"submit"===e.key?u.cloneElement(e,{children:l?"Create":"Save"}):e))]},children:[(0,g.jsxs)(q.U.Group,{children:[(0,g.jsx)(b.A,{width:"md",name:"name",label:"Quiz Name",placeholder:"Quiz Name",initialValue:null===o||void 0===o?void 0:o.name,rules:[{required:!0,message:"Quiz name is required"},{pattern:/^[a-z0-9\s]+$/i,message:"Quiz name can only contain letters, numbers, and spaces"}]}),(0,g.jsx)(b.A,{width:"md",name:"description",label:"Quiz Description",placeholder:"Quiz Description",initialValue:null===o||void 0===o?void 0:o.description,rules:[{required:!0,message:"Quiz description is required"},{max:100,message:"Description must be less than 100 characters"}]})]}),(0,g.jsx)(S,{})]})},D=()=>{const e=(0,c.wA)();(0,u.useEffect)((()=>{try{e((0,m.Ij)())}catch(t){console.error(t),r.Ay.error("Failed to fetch quizzes")}}),[]);const t=(0,c.d4)((e=>e.user.quizzes)),[s,p]=(0,u.useState)(!1),[h,w]=(0,u.useState)(null),y=s=>{w(s);const r=t.find((e=>e.quizId===s));e((0,m.ot)(r||{questions:[]})),p(!0)};return(0,g.jsxs)(n.Ay,{theme:{components:{Layout:{headerBg:"#f5f5f5"}}},children:[(0,g.jsxs)(i.A,{children:[(0,g.jsxs)(d.Y9,{className:"flex items-center justify-between px-0",children:[(0,g.jsx)("div",{children:(0,g.jsx)(a.Ay,{type:"primary",className:"mr-2",onClick:()=>y(0),children:"Create new quiz"})}),(0,g.jsx)(o.A,{options:["Recent Edited","Newest","Oldest"],onChange:s=>{console.log(s);const r=t.slice().sort(((e,t)=>"Recent Edited"===s?t.timeLastEdited-e.timeLastEdited:"Newest"===s?t.timeCreated-e.timeCreated:"Oldest"===s?e.timeCreated-t.timeCreated:0));e((0,m.AL)(r))}})]}),(0,g.jsx)(d.UC,{children:(0,g.jsx)(l.A,{style:{flexWrap:"wrap"},justify:"flex-start",align:"flex-start",gap:8,children:t.map((e=>(0,g.jsx)(v,{quiz:e,onClick:()=>y(e.quizId)},e.quizId)))})})]}),(0,g.jsx)(P,{open:s,setOpen:p})]})}},66925:(e,t,s)=>{s.d(t,{Q:()=>i});var r=s(16569),n=s(8821);async function i(e){try{await e()}catch(i){var t,s;return i instanceof n.pe?r.Ay.error((null===(t=i.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.error)||"Internal server error"):i instanceof Error?r.Ay.error(i.message):r.Ay.error("An unknown error occurred")}}}}]);
//# sourceMappingURL=690.b30a2634.chunk.js.map